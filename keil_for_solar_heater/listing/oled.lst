C51 COMPILER V9.01   OLED                                                                  11/21/2025 16:16:27 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN .\output\oled.obj
COMPILER INVOKED BY: C:\Program Files\KEIL4\C51\BIN\C51.EXE OLED\oled.c BROWSE INCDIR(.\OLED) DEBUG OBJECTEXTEND PRINT(.
                    -\listing\oled.lst) OBJECT(.\output\oled.obj)

line level    source

   1          #include "oled.h"
   2          #include "oledfont.h"
   3                                             
   4          void delay_ms(unsigned int ms)
   5          {                         
   6   1              unsigned int a;
   7   1              while(ms)
   8   1              {
   9   2                      a=1800;
  10   2                      while(a--);
  11   2                      ms--;
  12   2              }
  13   1              return;
  14   1      }
  15          /**********************************************
  16          //IIC Start
  17          **********************************************/
  18          void IIC_Start()
  19          {
  20   1      
  21   1              OLED_SCLK_Set() ;
  22   1              OLED_SDIN_Set();
  23   1              OLED_SDIN_Clr();
  24   1              OLED_SCLK_Clr();
  25   1      }
  26          
  27          /**********************************************
  28          //IIC Stop
  29          **********************************************/
  30          void IIC_Stop()
  31          {
  32   1      OLED_SCLK_Set() ;
  33   1      //      OLED_SCLK_Clr();
  34   1              OLED_SDIN_Clr();
  35   1              OLED_SDIN_Set();
  36   1              
  37   1      }
  38          
  39          void IIC_Wait_Ack()
  40          {
  41   1      
  42   1              //GPIOB->CRH &= 0XFFF0FFFF;     //设置PB12为上拉输入模式
  43   1              //GPIOB->CRH |= 0x00080000;
  44   1      //      OLED_SDA = 1;
  45   1      //      delay_us(1);
  46   1              //OLED_SCL = 1;
  47   1              //delay_us(50000);
  48   1      /*      while(1)
  49   1              {
  50   1                      if(!OLED_SDA)                           //判断是否接收到OLED 应答信号
  51   1                      {
  52   1                              //GPIOB->CRH &= 0XFFF0FFFF;     //设置PB12为通用推免输出模式
  53   1                              //GPIOB->CRH |= 0x00030000;
  54   1                              return;
C51 COMPILER V9.01   OLED                                                                  11/21/2025 16:16:27 PAGE 2   

  55   1                      }
  56   1              }
  57   1      */
  58   1              OLED_SCLK_Set() ;
  59   1              OLED_SCLK_Clr();
  60   1      }
  61          /**********************************************
  62          // IIC Write byte
  63          **********************************************/
  64          
  65          void Write_IIC_Byte(unsigned char IIC_Byte)
  66          {
  67   1              unsigned char i;
  68   1              unsigned char m,da;
  69   1              da=IIC_Byte;
  70   1              OLED_SCLK_Clr();
  71   1              for(i=0;i<8;i++)                
  72   1              {
  73   2                              m=da;
  74   2                      //      OLED_SCLK_Clr();
  75   2                      m=m&0x80;
  76   2                      if(m==0x80)
  77   2                      {OLED_SDIN_Set();}
  78   2                      else OLED_SDIN_Clr();
  79   2                              da=da<<1;
  80   2                      OLED_SCLK_Set();
  81   2                      OLED_SCLK_Clr();
  82   2                      }
  83   1      
  84   1      
  85   1      }
  86          /**********************************************
  87          // IIC Write Command
  88          **********************************************/
  89          void Write_IIC_Command(unsigned char IIC_Command)
  90          {
  91   1         IIC_Start();
  92   1         Write_IIC_Byte(0x78);            //Slave address,SA0=0
  93   1              IIC_Wait_Ack(); 
  94   1         Write_IIC_Byte(0x00);                        //write command
  95   1              IIC_Wait_Ack(); 
  96   1         Write_IIC_Byte(IIC_Command); 
  97   1              IIC_Wait_Ack(); 
  98   1         IIC_Stop();
  99   1      }
 100          /**********************************************
 101          // IIC Write Data
 102          **********************************************/
 103          void Write_IIC_Data(unsigned char IIC_Data)
 104          {
 105   1         IIC_Start();
 106   1         Write_IIC_Byte(0x78);                        //D/C#=0; R/W#=0
 107   1              IIC_Wait_Ack(); 
 108   1         Write_IIC_Byte(0x40);                        //write data
 109   1              IIC_Wait_Ack(); 
 110   1         Write_IIC_Byte(IIC_Data);
 111   1              IIC_Wait_Ack(); 
 112   1         IIC_Stop();
 113   1      }
 114          void OLED_WR_Byte(unsigned dat,unsigned cmd)
 115          {
 116   1              if(cmd)
C51 COMPILER V9.01   OLED                                                                  11/21/2025 16:16:27 PAGE 3   

 117   1                              {
 118   2      
 119   2         Write_IIC_Data(dat);
 120   2         
 121   2                      }
 122   1              else {
 123   2         Write_IIC_Command(dat);
 124   2                      
 125   2              }
 126   1      
 127   1      
 128   1      }
 129          
 130          /********************************************
 131          // fill_Picture
 132          ********************************************/
 133          void fill_picture(unsigned char fill_Data)
 134          {
 135   1              unsigned char m,n;
 136   1              for(m=0;m<8;m++)
 137   1              {
 138   2                      OLED_WR_Byte(0xb0+m,0);         //page0-page1
 139   2                      OLED_WR_Byte(0x02,0);           //low column start address
 140   2                      OLED_WR_Byte(0x10,0);           //high column start address
 141   2                      for(n=0;n<128;n++)
 142   2                              {
 143   3                                      OLED_WR_Byte(fill_Data,1);
 144   3                              }
 145   2              }
 146   1      }
 147          
 148          
 149          /***********************Delay****************************************/
 150          void Delay_50ms(unsigned int Del_50ms)
 151          {
 152   1              unsigned int m;
 153   1              for(;Del_50ms>0;Del_50ms--)
 154   1                      for(m=6245;m>0;m--);
 155   1      }
 156          
 157          void Delay_1ms(unsigned int Del_1ms)
 158          {
 159   1              unsigned char j;
 160   1              while(Del_1ms--)
 161   1              {       
 162   2                      for(j=0;j<123;j++);
 163   2              }
 164   1      }
 165          
 166          //坐标设置
 167          
 168                  void OLED_Set_Pos(unsigned char x, unsigned char y) 
 169          {       OLED_WR_Byte(0xb0+y,OLED_CMD);
 170   1              OLED_WR_Byte((((x+2)&0xf0)>>4)|0x10,OLED_CMD);
 171   1              OLED_WR_Byte(((x+2)&0x0f),OLED_CMD); 
 172   1      }         
 173          //开启OLED显示    
 174          void OLED_Display_On(void)
 175          {
 176   1              OLED_WR_Byte(0X8D,OLED_CMD);  //SET DCDC命令
 177   1              OLED_WR_Byte(0X14,OLED_CMD);  //DCDC ON
 178   1              OLED_WR_Byte(0XAF,OLED_CMD);  //DISPLAY ON
C51 COMPILER V9.01   OLED                                                                  11/21/2025 16:16:27 PAGE 4   

 179   1      }
 180          //关闭OLED显示     
 181          void OLED_Display_Off(void)
 182          {
 183   1              OLED_WR_Byte(0X8D,OLED_CMD);  //SET DCDC命令
 184   1              OLED_WR_Byte(0X10,OLED_CMD);  //DCDC OFF
 185   1              OLED_WR_Byte(0XAE,OLED_CMD);  //DISPLAY OFF
 186   1      }                                        
 187          //清屏函数,清完屏,整个屏幕是黑色的!和没点亮一样!!!        
 188          void OLED_Clear(void)  
 189          {  
 190   1              u8 i,n;             
 191   1              for(i=0;i<8;i++)  
 192   1              {  
 193   2                      OLED_WR_Byte (0xb0+i,OLED_CMD);    //设置页地址（0~7）
 194   2                      OLED_WR_Byte (0x02,OLED_CMD);      //设置显示位置―列低地址
 195   2                      OLED_WR_Byte (0x10,OLED_CMD);      //设置显示位置―列高地址   
 196   2                      for(n=0;n<128;n++)OLED_WR_Byte(0,OLED_DATA); 
 197   2              } //更新显示
 198   1      }
 199          void OLED_On(void)  
 200          {  
 201   1              u8 i,n;             
 202   1              for(i=0;i<8;i++)  
 203   1              {  
 204   2                      OLED_WR_Byte (0xb0+i,OLED_CMD);    //设置页地址（0~7）
 205   2                      OLED_WR_Byte (0x02,OLED_CMD);      //设置显示位置―列低地址
 206   2                      OLED_WR_Byte (0x10,OLED_CMD);      //设置显示位置―列高地址   
 207   2                      for(n=0;n<128;n++)OLED_WR_Byte(1,OLED_DATA); 
 208   2              } //更新显示
 209   1      }
 210          //在指定位置显示一个字符,包括部分字符
 211          //x:0~127
 212          //y:0~63
 213          //mode:0,反白显示;1,正常显示                             
 214          //size:选择字体 16/12 
 215          void OLED_ShowChar(u8 x,u8 y,u8 chr,u8 Char_Size)
 216          {       
 217   1              unsigned char c=0,i=0;  
 218   1                      c=chr-' ';//得到偏移后的值                      
 219   1                      if(x>Max_Column-1){x=0;y=y+2;}
 220   1                      if(Char_Size ==16)
 221   1                              {
 222   2                              OLED_Set_Pos(x,y);      
 223   2                              for(i=0;i<8;i++)
 224   2                              OLED_WR_Byte(F8X16[c*16+i],OLED_DATA);
 225   2                              OLED_Set_Pos(x,y+1);
 226   2                              for(i=0;i<8;i++)
 227   2                              OLED_WR_Byte(F8X16[c*16+i+8],OLED_DATA);
 228   2                              }
 229   1                              else {  
 230   2                                      OLED_Set_Pos(x,y);
 231   2                                      for(i=0;i<6;i++)
 232   2                                      OLED_WR_Byte(F6x8[c][i],OLED_DATA);
 233   2                                      
 234   2                              }
 235   1      }
 236          //m^n函数
 237          u32 oled_pow(u8 m,u8 n)
 238          {
 239   1              u32 result=1;    
 240   1              while(n--)result*=m;    
C51 COMPILER V9.01   OLED                                                                  11/21/2025 16:16:27 PAGE 5   

 241   1              return result;
 242   1      }                                 
 243          //显示2个数字
 244          //x,y :起点坐标  
 245          //len :数字的位数
 246          //size:字体大小
 247          //mode:模式     0,填充模式;1,叠加模式
 248          //num:数值(0~4294967295);                         
 249          void OLED_ShowNum(u8 x,u8 y,u32 num,u8 len,u8 size2)
 250          {               
 251   1              u8 t,temp;
 252   1              u8 enshow=0;                                               
 253   1              for(t=0;t<len;t++)
 254   1              {
 255   2                      temp=(num/oled_pow(10,len-t-1))%10;
 256   2                      if(enshow==0&&t<(len-1))
 257   2                      {
 258   3                              if(temp==0)
 259   3                              {
 260   4                                      OLED_ShowChar(x+(size2/2)*t,y,' ',size2);
 261   4                                      continue;
 262   4                              }else enshow=1; 
 263   3                               
 264   3                      }
 265   2                      OLED_ShowChar(x+(size2/2)*t,y,temp+'0',size2); 
 266   2              }
 267   1      } 
 268          
 269          //显示数字
 270          //x,y :起点坐标
 271          //num :要显示的数字
 272          //len :数字的位数
 273          //size:字体大小
 274          //mode:0,反色显示;1,正常显示
 275          void OLED_ShowNum2(u8 x,u8 y,u32 num,u8 len,u8 size1,u8 mode)
 276          {
 277   1              u8 t,temp,m=0;
 278   1              if(size1==8)m=2;
 279   1              for(t=0;t<len;t++)
 280   1              {
 281   2                      temp=(num/oled_pow(10,len-t-1))%10;
 282   2                              if(temp==0)
 283   2                              {
 284   3                                      OLED_ShowChar(x+(size1/2+m)*t,y,'0',size1);
 285   3            }
 286   2                              else 
 287   2                              {
 288   3                                OLED_ShowChar(x+(size1/2+m)*t,y,temp+'0',size1);
 289   3                              }
 290   2        }
 291   1      }
*** WARNING C280 IN LINE 275 OF OLED\OLED.C: 'mode': unreferenced local variable
 292          //显示一个字符号串
 293          void OLED_ShowString(u8 x,u8 y,u8 *chr,u8 Char_Size)
 294          {
 295   1              unsigned char j=0;
 296   1              while (chr[j]!='\0')
 297   1              {               OLED_ShowChar(x,y,chr[j],Char_Size);
 298   2                              x+=8;
 299   2                      if(x>120){x=0;y+=2;}
 300   2                              j++;
 301   2              }
C51 COMPILER V9.01   OLED                                                                  11/21/2025 16:16:27 PAGE 6   

 302   1      }
 303          //显示汉字
 304          void OLED_ShowCHinese(u8 x,u8 y,u8 no)
 305          {                           
 306   1              u8 t,adder=0;
 307   1              OLED_Set_Pos(x,y);      
 308   1          for(t=0;t<16;t++)
 309   1                      {
 310   2                                      OLED_WR_Byte(Hzk[2*no][t],OLED_DATA);
 311   2                                      adder+=1;
 312   2           }  
 313   1                      OLED_Set_Pos(x,y+1);    
 314   1          for(t=0;t<16;t++)
 315   1                              {       
 316   2                                      OLED_WR_Byte(Hzk[2*no+1][t],OLED_DATA);
 317   2                                      adder+=1;
 318   2            }                                 
 319   1      }
 320          /***********功能描述：显示显示BMP图片128×64起始点坐标(x,y),x的范围0～127，y为页的范围0～7****************
             -*/
 321          void OLED_DrawBMP(unsigned char x0, unsigned char y0,unsigned char x1, unsigned char y1,unsigned char BMP[
             -])
 322          {       
 323   1       unsigned int j=0;
 324   1       unsigned char x,y;
 325   1        
 326   1        if(y1%8==0) y=y1/8;      
 327   1        else y=y1/8+1;
 328   1              for(y=y0;y<y1;y++)
 329   1              {
 330   2                      OLED_Set_Pos(x0,y);
 331   2          for(x=x0;x<x1;x++)
 332   2                  {      
 333   3                      OLED_WR_Byte(BMP[j++],OLED_DATA);               
 334   3                  }
 335   2              }
 336   1      } 
 337          
 338          //初始化SSD1306                                     
 339          void OLED_Init(void)
 340          {       
 341   1       
 342   1      OLED_WR_Byte(0xAE,OLED_CMD);//--display off
 343   1              OLED_WR_Byte(0x00,OLED_CMD);//---set low column address
 344   1              OLED_WR_Byte(0x10,OLED_CMD);//---set high column address
 345   1              OLED_WR_Byte(0x40,OLED_CMD);//--set start line address  
 346   1              OLED_WR_Byte(0xB0,OLED_CMD);//--set page address
 347   1              OLED_WR_Byte(0x81,OLED_CMD); // contract control
 348   1              OLED_WR_Byte(0xFF,OLED_CMD);//--128   
 349   1              OLED_WR_Byte(0xA1,OLED_CMD);//set segment remap 
 350   1              OLED_WR_Byte(0xA6,OLED_CMD);//--normal / reverse
 351   1              OLED_WR_Byte(0xA8,OLED_CMD);//--set multiplex ratio(1 to 64)
 352   1              OLED_WR_Byte(0x3F,OLED_CMD);//--1/32 duty
 353   1              OLED_WR_Byte(0xC8,OLED_CMD);//Com scan direction
 354   1              OLED_WR_Byte(0xD3,OLED_CMD);//-set display offset
 355   1              OLED_WR_Byte(0x00,OLED_CMD);//
 356   1              
 357   1              OLED_WR_Byte(0xD5,OLED_CMD);//set osc division
 358   1              OLED_WR_Byte(0x80,OLED_CMD);//
 359   1              
 360   1              OLED_WR_Byte(0xD8,OLED_CMD);//set area color mode off
 361   1              OLED_WR_Byte(0x05,OLED_CMD);//
C51 COMPILER V9.01   OLED                                                                  11/21/2025 16:16:27 PAGE 7   

 362   1              
 363   1              OLED_WR_Byte(0xD9,OLED_CMD);//Set Pre-Charge Period
 364   1              OLED_WR_Byte(0xF1,OLED_CMD);//
 365   1              
 366   1              OLED_WR_Byte(0xDA,OLED_CMD);//set com pin configuartion
 367   1              OLED_WR_Byte(0x12,OLED_CMD);//
 368   1              
 369   1              OLED_WR_Byte(0xDB,OLED_CMD);//set Vcomh
 370   1              OLED_WR_Byte(0x30,OLED_CMD);//
 371   1              
 372   1              OLED_WR_Byte(0x8D,OLED_CMD);//set charge pump enable
 373   1              OLED_WR_Byte(0x14,OLED_CMD);//
 374   1              
 375   1              OLED_WR_Byte(0xAF,OLED_CMD);//--turn on oled panel
 376   1      }  
 377          
 378          
 379          
 380          
 381          
 382          
 383          
 384          
 385          
 386          
 387          
 388          
 389          
 390          
 391          
 392          
 393          
 394          
 395          
 396          
 397          
 398          
 399          
 400          
 401          
 402          
 403          
 404          
 405          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1374    ----
   CONSTANT SIZE    =   2136    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      51
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
